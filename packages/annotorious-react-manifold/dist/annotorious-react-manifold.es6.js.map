{"version":3,"file":"annotorious-react-manifold.es6.js","sources":["../src/AnnotoriousManifoldInstance.ts"],"sourcesContent":["import { Origin } from '@annotorious/react';\nimport type {\n  Annotation, \n  AnnotationBody, \n  Annotator\n} from '@annotorious/react';\n\nexport interface AnnotoriousManifoldInstance<I extends Annotation = Annotation, E extends { id: string } = Annotation> {\n\n  annotators: Annotator<I, E>[];\n\n  sources: string[];\n\n  addBody(body: AnnotationBody, origin?: Origin): void;\n\n  clear(origin: Origin): void;\n\n  deleteAnnotation(id: string, origin?: Origin): I | undefined;\n\n  deleteBody(body: AnnotationBody, origin?: Origin): void;\n\n  destroy(): void;\n\n  findAnnotator(annotationId: string): Annotator<I, E> | undefined;\n\n  findSource(annotationId: string): string | undefined;\n\n  getAnnotation(id: string): I | undefined;\n  \n  getAnnotations(): I[];\n\n  getAnnotator(id: string): Annotator<I, E> | undefined;\n  \n  setSelected(annotationId: string): void;\n\n  updateAnnotation(arg1: string | I, arg2?: I | Origin, arg3?: Origin): void;\n\n}\n\nexport const createManifoldInstance = <I extends Annotation = Annotation, E extends { id: string } = Annotation>(\n  annotators: Map<string, Annotator<I, E>>\n): AnnotoriousManifoldInstance<I, E> => {\n\n  const find = (annotationId: string): { annotation?: I, source?: string, annotator?: Annotator<I, E> } =>\n    Array.from(annotators.entries()).reduce((found, [source, annotator]) => {\n      if (found)\n        return found;\n\n      const annotation = annotator.state.store.getAnnotation(annotationId);\n      if (annotation) \n        return { annotation, annotator, source };\n    }, undefined as { annotation: I, annotator: Annotator<I, E> } | undefined ) || \n\n    { annotation: undefined, annotator: undefined, source: undefined };\n\n  /*********/\n  /** API **/\n  /*********/\n\n  const addBody = (body: AnnotationBody, origin = Origin.LOCAL) => {\n    const { annotator } = find(body.annotation);\n    if (annotator)\n      annotator.state.store.addBody(body, origin);\n  }\n\n  const clear = (origin = Origin.LOCAL) =>\n    Array.from(annotators.values()).forEach(a => a.state.store.clear(origin));\n\n  const deleteAnnotation = (id: string, origin = Origin.LOCAL) => {\n    const { annotation, annotator } = find(id);\n\n    if (annotator) {\n      annotator.state.store.deleteAnnotation(id, origin);\n      return annotation;\n    }\n  }\n\n  const deleteBody = (body: AnnotationBody, origin = Origin.LOCAL) => {\n    const { annotator } = find(body.annotation);\n    if (annotator)\n      annotator.state.store.deleteBody(body, origin);\n  }\n\n  const destroy = () =>\n    Array.from(annotators.values()).forEach(a => a.destroy());\n\n  const findAnnotator = (annotationId: string) => {\n    const { annotator } = find(annotationId);\n    return annotator;\n  }\n\n  const findSource = (annotationId: string) => {\n    const { source } = find(annotationId);\n    return source;\n  }\n\n  const getAnnotation = (annotationId: string) => \n    find(annotationId).annotation;\n\n  const getAnnotations = () => \n    Array.from(annotators.values()).reduce((all, annotator) =>\n      [...all, ...annotator.state.store.all()], [] as I[]);\n\n  const getAnnotator = (id: string) => annotators.get(id);\n\n  const updateAnnotation = (arg1: string | I, arg2?: I | Origin, arg3?: Origin) => {\n    const oldId: string = typeof arg1 === 'string' ? arg1 : arg1.id;\n\n    const { annotator } = find(oldId);\n    if (annotator)\n      annotator.state.store.updateAnnotation(arg1, arg2, arg3);\n  }\n\n  const setSelected = (id: string) => {\n    const { annotator } = find(id);\n    if (annotator)\n      annotator.setSelected(id);\n  }\n\n  return {\n    annotators: [...annotators.values()],\n    sources: [...annotators.keys()],\n    addBody,\n    clear,\n    deleteAnnotation,\n    deleteBody,\n    destroy,\n    findAnnotator,\n    findSource,\n    getAnnotation,\n    getAnnotations,\n    getAnnotator,\n    setSelected,\n    updateAnnotation\n  }\n\n}"],"names":["createManifoldInstance","annotators","find","annotationId","found","source","annotator","annotation","addBody","body","origin","Origin","clear","a","deleteAnnotation","id","deleteBody","destroy","findAnnotator","findSource","getAnnotation","getAnnotations","all","getAnnotator","updateAnnotation","arg1","arg2","arg3","oldId","setSelected"],"mappings":";AAuCa,MAAAA,IAAyB,CACpCC,MACsC;AAEtC,QAAMC,IAAO,CAACC,MACZ,MAAM,KAAKF,EAAW,SAAS,EAAE,OAAO,CAACG,GAAO,CAACC,GAAQC,CAAS,MAAM;AAClE,QAAAF;AACK,aAAAA;AAET,UAAMG,IAAaD,EAAU,MAAM,MAAM,cAAcH,CAAY;AAC/D,QAAAI;AACK,aAAA,EAAE,YAAAA,GAAY,WAAAD,GAAW,QAAAD;EACpC,GAAG,MAAuE,KAE1E,EAAE,YAAY,QAAW,WAAW,QAAW,QAAQ,OAAU,GAM7DG,IAAU,CAACC,GAAsBC,IAASC,EAAO,UAAU;AAC/D,UAAM,EAAE,WAAAL,EAAc,IAAAJ,EAAKO,EAAK,UAAU;AACtC,IAAAH,KACFA,EAAU,MAAM,MAAM,QAAQG,GAAMC,CAAM;AAAA,EAAA,GAGxCE,IAAQ,CAACF,IAASC,EAAO,UAC7B,MAAM,KAAKV,EAAW,OAAA,CAAQ,EAAE,QAAQ,CAAKY,MAAAA,EAAE,MAAM,MAAM,MAAMH,CAAM,CAAC,GAEpEI,IAAmB,CAACC,GAAYL,IAASC,EAAO,UAAU;AAC9D,UAAM,EAAE,YAAAJ,GAAY,WAAAD,EAAU,IAAIJ,EAAKa,CAAE;AAEzC,QAAIT;AACF,aAAAA,EAAU,MAAM,MAAM,iBAAiBS,GAAIL,CAAM,GAC1CH;AAAA,EACT,GAGIS,IAAa,CAACP,GAAsBC,IAASC,EAAO,UAAU;AAClE,UAAM,EAAE,WAAAL,EAAc,IAAAJ,EAAKO,EAAK,UAAU;AACtC,IAAAH,KACFA,EAAU,MAAM,MAAM,WAAWG,GAAMC,CAAM;AAAA,EAAA,GAG3CO,IAAU,MACd,MAAM,KAAKhB,EAAW,OAAA,CAAQ,EAAE,QAAQ,CAAAY,MAAKA,EAAE,QAAS,CAAA,GAEpDK,IAAgB,CAACf,MAAyB;AAC9C,UAAM,EAAE,WAAAG,EAAA,IAAcJ,EAAKC,CAAY;AAChC,WAAAG;AAAA,EAAA,GAGHa,IAAa,CAAChB,MAAyB;AAC3C,UAAM,EAAE,QAAAE,EAAA,IAAWH,EAAKC,CAAY;AAC7B,WAAAE;AAAA,EAAA,GAGHe,IAAgB,CAACjB,MACrBD,EAAKC,CAAY,EAAE,YAEfkB,IAAiB,MACrB,MAAM,KAAKpB,EAAW,OAAQ,CAAA,EAAE,OAAO,CAACqB,GAAKhB,MAC3C,CAAC,GAAGgB,GAAK,GAAGhB,EAAU,MAAM,MAAM,IAAI,CAAC,GAAG,CAAA,CAAS,GAEjDiB,IAAe,CAACR,MAAed,EAAW,IAAIc,CAAE,GAEhDS,IAAmB,CAACC,GAAkBC,GAAmBC,MAAkB;AAC/E,UAAMC,IAAgB,OAAOH,KAAS,WAAWA,IAAOA,EAAK,IAEvD,EAAE,WAAAnB,EAAA,IAAcJ,EAAK0B,CAAK;AAC5B,IAAAtB,KACFA,EAAU,MAAM,MAAM,iBAAiBmB,GAAMC,GAAMC,CAAI;AAAA,EAAA,GAGrDE,IAAc,CAACd,MAAe;AAClC,UAAM,EAAE,WAAAT,EAAA,IAAcJ,EAAKa,CAAE;AACzB,IAAAT,KACFA,EAAU,YAAYS,CAAE;AAAA,EAAA;AAGrB,SAAA;AAAA,IACL,YAAY,CAAC,GAAGd,EAAW,QAAQ;AAAA,IACnC,SAAS,CAAC,GAAGA,EAAW,MAAM;AAAA,IAC9B,SAAAO;AAAA,IACA,OAAAI;AAAA,IACA,kBAAAE;AAAA,IACA,YAAAE;AAAA,IACA,SAAAC;AAAA,IACA,eAAAC;AAAA,IACA,YAAAC;AAAA,IACA,eAAAC;AAAA,IACA,gBAAAC;AAAA,IACA,cAAAE;AAAA,IACA,aAAAM;AAAA,IACA,kBAAAL;AAAA,EAAA;AAGJ;"}